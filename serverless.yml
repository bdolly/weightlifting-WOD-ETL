# Main Serverless Framework configuration file
# This file references modular configuration files for better maintainability

service: invictus-weightlifting-wod-etl

app: invictus-weightlifting-app
org: bromeodolly

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
# Pinned to V2.x to avoid V4 breaking changes
# IMPORTANT: Always use 'npx serverless' instead of global 'serverless' command
# The global command uses V4 which is incompatible with this project
frameworkVersion: '>=2.0.0 <3.0.0'

useDotenv: true

provider:
  name: aws
  region: ${env:AWS_REGION}
  runtime: python3.9
  profile: ${env:AWS_PROFILE, 'serverless-invictus-agent'}
  stage: dev
  lambdaHashingVersion: 20201221
  iamRoleStatements: ${file(./serverless/iam.yml)}
  environment: ${file(./serverless/environment.yml)}

# you can add packaging information here
package:
  exclude:
    - node_modules/**
    - venv/**
    - __pycache__/**
    - test_events
    - .serverless/**

plugins:
  - serverless-python-requirements
  - serverless-step-functions

custom:
  pythonRequirements:
    dockerizePip: non-linux
    dockerImage: public.ecr.aws/sam/build-python3.9

functions: ${file(./serverless/functions.yml)}

stepFunctions:
  stateMachines:
    ${file(./SemiStructureInvictusPost_stateMachine.yml)}

resources: ${file(./serverless/resources.yml)}
